---
title: "Laboratory 4"
author: "Emily Tipton"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: yes
---
# Tasks

# Task 1
```{r}
getwd()
```

## Task 2

```{r}
spruce <- read.csv("SPRUCE.csv")
tail(spruce)
```

## Task 3

### Create a scatter plot

```{r}
library(s20x)

trendscatter(data = spruce, Height~BHDiameter, f = 0.5, main = "f=0.5")
```

### Make a linear model object

```{r}
spruce_lm=with(spruce,lm(Height~BHDiameter))
```

### Find residuals

```{r}
height_res = residuals(spruce_lm)
height_res
```

### Find fitted values

```{r}
height_fit = fitted(spruce_lm)
height_fit
```

### Plot residuals vs fitted values

```{r}
plot(height_fit, height_res, xlab = "Fitted values", ylab = "Residuals", main = "Residuals vs Fitted values", pch =21, bg = "pink", cex = 1.2)
```

### Plot residuals vs fitted values using trendscatter()

```{r}
trendscatter(data = spruce_lm, height_res~height_fit, f = 0.5, main = "Residuals vs Fitted Values", xlab = "Fitted values", ylab = "Residuals")
```

### Describe the plot and compare

The residuals vs fitted values trendscatter has a negative quadratic shape. There's a peak near the middle. The first trendscatter with the Height and BHDiameter data doesn't have a dramatic decrease after the peak. 

### Make the residual plot using spruce_lm

```{r}
plot(spruce_lm, which = 1, pch = 21, bg = "black")
```

### Check normality

```{r}
normcheck(spruce_lm, shapiro.wilk = TRUE)
```

### P-value and NULL hypothesis

P-value = 0.29
If the p-value is < 0.05, we reject the NULL hypothesis. In this case, since our p-value = 0.29 > 0.05, we will accept the NULL hypothesis.

### Conclusions

Although we accept the NULL hypothesis based on the p-value, there's evidence to show that the straight line model is not the best fit for our data. The residuals vs fitted values plot show a quadratic curve, meaning a straight line model wouldn't be an appropriate choice. There's signal in the test when it should be noise, furthering the point that a straight line is not the best fit.

## Task 4

### Fit a quadratic

```{r}
quad_lm = lm(Height~BHDiameter + I(BHDiameter ^2), data=spruce)

summary(quad_lm)
```

### Scatter plot with quadratic curve

```{r}
coef(quad_lm)
```


```{r}
plot(spruce, main = "Height vs BHDiameter", pch =21, bg = "black")

quadplot = function(x) {
  quad_lm$coefficients[1] + quad_lm$coefficients[2] * x + quad_lm$coefficients[3] * x ^2
}

curve(quadplot, lwd = 2, col = "deeppink3", add = TRUE)
```

### Vector of fitted values

```{r}
quad_fit = fitted(quad_lm)
```

### Residuals vs Fitted values from quad_lm

```{r}
plot(quad_lm, which = 1, pch = 21, bg = "black")
```

### Check normality

```{r}
normcheck(quad_lm, shapiro.wilk = TRUE)
```

### Conclusions

The P-value is 0.684 which is larger than the P-value from our previous Shapiro-Wilk normality check. This means that the quadratic curve that we fit to our data is more accurate than the straight line. There is significantly less signal which is what we were aiming for. The shape from our normality check is much more symmetrical. 

## Task 5

### Summarize quad_lm

```{r}
summary(quad_lm)
```

### Estimate values

$\hat{\beta_{0}}$ = 0.860896

$\hat{\beta_{1}}$ = 1.469592

$\hat{\beta_{2}}$ = -0.027457

### Interval estimates

```{r}
ciReg(quad_lm)
```

### Equation of fitted line


$$ f(x) = 0.860896 + 1.469592x - 0.027457x^2 $$

### Predict height of spruce

diameter = 15, 18, and 20 cm

```{r}
predict(quad_lm, data.frame(BHDiameter=c(15,18,20)))
```

### Previous predictions

```{r}
predict(spruce_lm, data.frame(BHDiameter=c(15, 18, 20)))
```

```{r}
with(spruce,
     plot(Height~BHDiameter, data = spruce, main = "Height vs BHDiameter", ylab = "Height (m)", xlab = "Breast Height Diameter (cm)", pch =21, bg = "blue", cex=1.2, xlim = c(0, max(BHDiameter)*1.1), ylim = c(0, max(Height) * 1.1))
)

abline(spruce_lm)
```
 
```{r}
plot(spruce, main = "Height vs BHDiameter", pch =21, bg = "black")

quadplot = function(x) {
  quad_lm$coefficients[1] + quad_lm$coefficients[2] * x + quad_lm$coefficients[3] * x ^2
}

curve(quadplot, lwd = 2, col = "deeppink3", add = TRUE)
```

By observing the two plots visually, we can see that the straight line is lower than our data points whereas the quadratic line is much closer to the data points on the plots.
This is represented numerically with the predict function.
The quadratic fit is more accurate to the data points than the straight line.

### Value of multiple $R^2$

```{r}
summary(quad_lm)
```

According to the summary table, multiple $R^2$ = 0.7741

```{r}
summary(spruce_lm)
```

Our previous multiple $R^2$ value was 0.6569 

The value of $R^2$ in the current model is greater than the previous one. 

### Adjusted $R^2$

The adjusted $R^2$ value for the quad fit is 0.7604 and 0.6468 for the linear fit. 

### (multiple $R^2$)

### Variability in Height

### anova

```{r}
anova(spruce_lm)
anova(quad_lm)
```


### RSS, MSS, TSS, MSS / TSS

```{r}
RSS=with(spruce, sum((Height-quad_fit)^2))
RSS
```
```{r}
MSS = with(spruce, sum((quad_fit-mean(Height))^2))
MSS
```

```{r}
TSS = with(spruce, sum((Height-mean(Height))^2))
TSS
```

```{r}
MSS / TSS
```




